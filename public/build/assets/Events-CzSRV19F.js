import{K as we,r as g,m as be,j as e,L as _e,S as b}from"./app-BFlZVLfL.js";import{A as J,a as V}from"./alert-D_H0EuGj.js";import{B as y}from"./badge-B70FZcBD.js";import{B as d}from"./button-Boy8FKKL.js";import{C as Y,b as Ce,c as De,d as ke,a as K}from"./card-Baaz4UcA.js";import{C as T}from"./checkbox--RfwaYSn.js";import{D as W,b as q,c as X,d as Q,e as Z}from"./dialog-BYaWsI-H.js";import{I as D}from"./input-BJFJWlOJ.js";import{L as p}from"./label-BSlL-ZQ-.js";import{T as Se}from"./textarea-DzP2BcMN.js";import Ee from"./Header-BoBphSoB.js";import ee from"./Sidebar-D-KmSDId.js";import{G as Me,L as Pe,C as Fe,a as Te}from"./list-DeDxaq61.js";import{P as se,S as te}from"./square-pen-CA6efpK6.js";import{C as Oe}from"./calendar-DLubJaV-.js";import{C as ae}from"./clock-DDbtvxiH.js";import{M as re}from"./map-pin-C6G6Q1Y8.js";import{U as ie}from"./users-8-TyVH4X.js";import{E as le}from"./eye-DW0qnS2w.js";import{T as $e}from"./trash-2-1VHapZdN.js";import{X as ze}from"./x-DO3D6a5g.js";import{U as Ie}from"./upload-Ck9vn2kN.js";import"./index-BKyhXRh8.js";import"./Combination-D54iwMCs.js";import"./index-BX-lmGkT.js";import"./createLucideIcon-Dlxr-Bzl.js";import"./dropdown-menu-CtBiUUKH.js";import"./index-CtBsO7PD.js";import"./user-B5rPnYOR.js";import"./log-out-DFpwgHaE.js";import"./chart-column-ZjZPA60R.js";import"./qr-code-DsoGfgRN.js";import"./file-text-CYfmmFJX.js";function js({events:_,puroks:ne}){const{flash:o}=we().props,[O,$]=g.useState(!1),[ce,w]=g.useState(!1),[de,z]=g.useState(new Set),[C,I]=g.useState("calendar"),[A,L]=g.useState(new Date),[n,u]=g.useState(null),[k,S]=g.useState(null),N=g.useRef(null),{data:t,setData:m,processing:U,errors:c,reset:oe}=be({title:"",description:"",start_date:"",end_date:"",purok_ids:[],has_certificate:!1,target_all_residents:!1,image:null}),j=A.getMonth(),f=A.getFullYear(),me=new Date(f,j,1),xe=new Date(f,j+1,0),he=me.getDay(),E=xe.getDate(),M=he,ge=Math.ceil((E+M)/7)*7,pe=["January","February","March","April","May","June","July","August","September","October","November","December"],ue=g.useMemo(()=>{const s={};return _.forEach(a=>{const i=new Date(a.start_date),r=`${i.getFullYear()}-${i.getMonth()}-${i.getDate()}`;s[r]||(s[r]=[]),s[r].push(a)}),s},[_]),P=s=>{const a=`${s.getFullYear()}-${s.getMonth()}-${s.getDate()}`;return ue[a]||[]},B=s=>{L(a=>{const i=new Date(a);return s==="prev"?i.setMonth(i.getMonth()-1):i.setMonth(i.getMonth()+1),i})},je=()=>{L(new Date)},fe=()=>{const s=[],a=new Date(f,j-1,0);for(let r=M-1;r>=0;r--){const x=new Date(f,j-1,a.getDate()-r),l=P(x);s.push(e.jsxs("div",{className:"min-h-12 border border-gray-200 bg-gray-50 p-1 opacity-40 sm:min-h-16 sm:p-2 lg:min-h-24",children:[e.jsx("div",{className:"text-sm text-gray-500",children:x.getDate()}),l.length>0&&e.jsxs("div",{className:"mt-1 space-y-1",children:[l.slice(0,2).map(h=>e.jsx("div",{className:"cursor-pointer truncate rounded bg-gray-200 px-1 py-0.5 text-xs text-gray-600",onClick:()=>u(h),children:h.title},h.id)),l.length>2&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",l.length-2," more"]})]})]},`prev-${r}`))}for(let r=1;r<=E;r++){const x=new Date(f,j,r),l=P(x),h=new Date().toDateString()===x.toDateString();s.push(e.jsxs("div",{className:`min-h-12 border border-gray-200 bg-white p-1 sm:min-h-16 sm:p-2 lg:min-h-24 ${h?"border-blue-300 bg-blue-50":""}`,children:[e.jsxs("div",{className:`text-sm font-medium ${h?"text-blue-600":"text-gray-900"}`,children:[r,h]}),l.length>0&&e.jsxs("div",{className:"mt-1 space-y-1",children:[l.slice(0,2).map(v=>e.jsx("div",{className:`cursor-pointer truncate rounded px-1 py-0.5 text-xs font-medium ${v.status==="approved"?"bg-green-100 text-green-700":v.status==="declined"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,onClick:()=>u(v),title:v.title,children:v.title},v.id)),l.length>2&&e.jsxs("div",{className:"cursor-pointer text-xs text-gray-500 hover:text-gray-700",children:["+",l.length-2," more"]})]})]},r))}const i=ge-E-M;for(let r=1;r<=i;r++){const x=new Date(f,j+1,r),l=P(x);s.push(e.jsxs("div",{className:"min-h-12 border border-gray-200 bg-gray-50 p-1 opacity-40 sm:min-h-16 sm:p-2 lg:min-h-24",children:[e.jsx("div",{className:"text-sm text-gray-500",children:r}),l.length>0&&e.jsxs("div",{className:"mt-1 space-y-1",children:[l.slice(0,2).map(h=>e.jsx("div",{className:"cursor-pointer truncate rounded bg-gray-200 px-1 py-0.5 text-xs text-gray-600",onClick:()=>u(h),children:h.title},h.id)),l.length>2&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",l.length-2," more"]})]})]},`next-${r}`))}return s},Ne=s=>{confirm("Are you sure you want to delete this event?")&&(z(a=>new Set(a).add(s)),b.delete(route("secretary.events.delete",s),{onFinish:()=>{z(a=>{const i=new Set(a);return i.delete(s),i}),u(null)}}))},R=s=>{b.get(route("secretary.events.attendees",s))},G=s=>{switch(s){case"approved":return"bg-green-100 text-green-800";case"declined":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},F=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=s=>new Date(s)<new Date,ve=s=>{s.preventDefault();const a=new FormData;a.append("title",t.title),a.append("description",t.description),a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date),t.purok_ids.length>0&&t.purok_ids.forEach((i,r)=>{a.append(`purok_ids[${r}]`,i.toString())}),a.append("has_certificate",t.has_certificate?"1":"0"),a.append("target_all_residents",t.target_all_residents?"1":"0"),t.image&&a.append("image",t.image),b.post(route("secretary.events.create"),a,{forceFormData:!0,onSuccess:()=>{oe(),w(!1),S(null),N.current&&(N.current.value="")}})},ye=s=>{var i;const a=(i=s.target.files)==null?void 0:i[0];if(a){m("image",a);const r=new FileReader;r.onload=x=>{var l;S((l=x.target)==null?void 0:l.result)},r.readAsDataURL(a)}};return g.useEffect(()=>{if(o!=null&&o.success||o!=null&&o.error){const s=setTimeout(()=>{},5e3);return()=>clearTimeout(s)}},[o]),e.jsxs(e.Fragment,{children:[e.jsx(_e,{title:"Event Management"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(ee,{currentPage:"secretary.events"})}),O&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>$(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(ee,{currentPage:"secretary.events"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(Ee,{onMobileMenuToggle:()=>$(!O)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage and organize community events"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center rounded-lg border bg-white p-1",children:[e.jsxs(d,{variant:C==="calendar"?"default":"ghost",size:"sm",onClick:()=>I("calendar"),className:"h-8 px-3",children:[e.jsx(Me,{className:"mr-1 h-4 w-4"}),"Calendar"]}),e.jsxs(d,{variant:C==="list"?"default":"ghost",size:"sm",onClick:()=>I("list"),className:"h-8 px-3",children:[e.jsx(Pe,{className:"mr-1 h-4 w-4"}),"List"]})]}),e.jsxs(d,{onClick:()=>w(!0),className:"gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Create Event"]})]})]}),(o==null?void 0:o.success)&&e.jsx(J,{className:"border-green-200 bg-green-50",children:e.jsx(V,{className:"text-green-800",children:o.success})}),(o==null?void 0:o.error)&&e.jsx(J,{className:"border-red-200 bg-red-50",children:e.jsx(V,{className:"text-red-800",children:o.error})}),C==="calendar"&&e.jsxs(Y,{children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(De,{className:"text-2xl",children:[pe[j]," ",f]}),e.jsx(ke,{children:"View events in calendar format"})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:je,className:"w-full sm:w-auto",children:"Today"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>B("prev"),className:"flex-1 sm:flex-none",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 sm:hidden",children:"Prev"})]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>B("next"),className:"flex-1 sm:flex-none",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 sm:hidden",children:"Next"})]})]})]})]})}),e.jsxs(K,{children:[e.jsx("div",{children:e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-px",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsxs("div",{className:"bg-gray-100 p-2 text-center text-sm font-medium text-gray-600",children:[e.jsx("span",{className:"hidden sm:inline",children:s}),e.jsx("span",{className:"sm:hidden",children:s.slice(0,1)})]},s))})}),e.jsx("div",{children:e.jsx("div",{className:"grid grid-cols-7 gap-px overflow-hidden rounded-lg border border-gray-200",children:fe()})})]})]}),C==="list"&&e.jsx(Y,{children:e.jsx(K,{className:"p-6",children:_.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Oe,{className:"mx-auto mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No events found"}),e.jsx("p",{className:"mb-4 text-gray-600",children:"Create your first event to get started."}),e.jsxs(d,{onClick:()=>w(!0),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>{const a=de.has(s.id),i=H(s.start_date),r=s.status==="pending",x=s.status==="pending"||s.status==="declined";return e.jsx("div",{className:"rounded-lg border border-gray-200 p-6 transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsx(y,{className:G(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.has_certificate&&e.jsx(y,{variant:"outline",children:"Has Certificate"}),i&&e.jsx(y,{variant:"secondary",children:"Past Event"})]}),e.jsx("p",{className:"line-clamp-2 text-gray-600",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm text-gray-600 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:F(s.start_date)})]}),s.purok&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:s.purok.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.confirmed_attendees_count," attendees"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created by: ",s.creator.name," â€¢ ",F(s.created_at)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r&&e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>b.get(route("secretary.events.edit",s.id)),disabled:a,children:[e.jsx(te,{className:"mr-1 h-4 w-4"}),"Edit"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>R(s.id),disabled:a,children:[e.jsx(le,{className:"mr-1 h-4 w-4"}),"View Details"]}),x&&e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>Ne(s.id),disabled:a,className:"text-red-600 hover:text-red-700",children:[e.jsx($e,{className:"mr-1 h-4 w-4"}),"Delete"]})]})]})},s.id)})})})})]})})]})]}),n&&e.jsx(W,{open:!!n,onOpenChange:()=>u(null),children:e.jsxs(q,{className:"max-w-2xl",children:[e.jsxs(X,{children:[e.jsx(Q,{children:n.title}),e.jsx(Z,{children:"Event details and information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(y,{className:G(n.status),children:n.status.charAt(0).toUpperCase()+n.status.slice(1)}),n.has_certificate&&e.jsx(y,{variant:"outline",children:"Has Certificate"}),H(n.start_date)&&e.jsx(y,{variant:"secondary",children:"Past Event"})]}),e.jsx("p",{className:"text-gray-600",children:n.description}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:F(n.start_date)})]}),n.purok&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:n.purok.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[n.confirmed_attendees_count," attendees"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4",children:[n.status==="pending"&&e.jsxs(d,{size:"sm",onClick:()=>{b.get(route("secretary.events.edit",n.id)),u(null)},children:[e.jsx(te,{className:"mr-1 h-4 w-4"}),"Edit Event"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>{R(n.id),u(null)},children:[e.jsx(le,{className:"mr-1 h-4 w-4"}),"View Details"]})]})]})]})}),e.jsx(W,{open:ce,onOpenChange:w,children:e.jsxs(q,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(X,{children:[e.jsx(Q,{children:"Create New Event"}),e.jsx(Z,{children:"Fill in the details below to create a new community event that will be submitted for captain approval."})]}),e.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",children:"Event Title *"}),e.jsx(D,{id:"title",value:t.title,onChange:s=>m("title",s.target.value),placeholder:"Enter event title",className:c.title?"border-red-500":""}),c.title&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:c.title})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"description",children:"Description *"}),e.jsx(Se,{id:"description",value:t.description,onChange:s=>m("description",s.target.value),placeholder:"Enter event description",rows:4,className:c.description?"border-red-500":""}),c.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:c.description})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Event Image (Optional)"}),e.jsxs("div",{className:"mt-2 space-y-3",children:[k&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:k,alt:"Preview",className:"h-32 w-full rounded-lg border object-cover"}),e.jsx(d,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{S(null),m("image",null),N.current&&(N.current.value="")},children:e.jsx(ze,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(d,{type:"button",variant:"outline",onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()},className:"w-fit",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),k?"Change Image":"Upload Image"]}),e.jsx(D,{ref:N,type:"file",accept:"image/*",onChange:ye,className:"hidden"}),e.jsx("span",{className:"text-sm text-gray-500",children:"JPG, PNG, GIF up to 2MB"})]})]}),c.image&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:c.image})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(D,{id:"start_date",type:"datetime-local",value:t.start_date,min:new Date().toISOString().slice(0,16),onChange:s=>{m("start_date",s.target.value),t.end_date&&s.target.value>=t.end_date&&m("end_date","")},className:c.start_date?"border-red-500":""}),c.start_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:c.start_date})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"end_date",children:"End Date (Optional)"}),e.jsx(D,{id:"end_date",type:"datetime-local",value:t.end_date,min:t.start_date?new Date(new Date(t.start_date).getTime()+24*60*60*1e3).toISOString().slice(0,16):void 0,onChange:s=>m("end_date",s.target.value),className:c.end_date?"border-red-500":"",disabled:!t.start_date}),c.end_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:c.end_date}),!t.start_date&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Please select a start date first"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"target_all_residents",checked:t.target_all_residents,onCheckedChange:s=>m("target_all_residents",!!s)}),e.jsx(p,{htmlFor:"target_all_residents",className:"text-sm font-medium",children:"Target all residents (ignore purok selection)"})]}),!t.target_all_residents&&e.jsxs("div",{children:[e.jsx(p,{children:"Select Puroks (up to 3)"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:ne.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:`purok_${s.id}`,checked:t.purok_ids.includes(s.id),onCheckedChange:a=>{a?t.purok_ids.length<3&&m("purok_ids",[...t.purok_ids,s.id]):m("purok_ids",t.purok_ids.filter(i=>i!==s.id))},disabled:!t.purok_ids.includes(s.id)&&t.purok_ids.length>=3}),e.jsx(p,{htmlFor:`purok_${s.id}`,className:"text-sm",children:s.name})]},s.id))}),t.purok_ids.length===0&&!t.target_all_residents&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:'Please select at least one purok or check "Target all residents"'}),c.purok_ids&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:c.purok_ids})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"has_certificate",checked:t.has_certificate,onCheckedChange:s=>m("has_certificate",!!s)}),e.jsx(p,{htmlFor:"has_certificate",className:"text-sm font-medium",children:"This event will provide certificates"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(d,{type:"submit",disabled:U,children:U?"Creating...":"Create Event"})]})]})]})})]})}export{js as default};
