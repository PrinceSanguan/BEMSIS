import{K as W,r as x,m as Y,j as e,L as Z,S as _}from"./app-CuuzbVEq.js";import{A as F,a as P}from"./alert-BB5lBvb-.js";import{B as T}from"./badge-BuJLMOV_.js";import{B as l}from"./button-Bz73IOL-.js";import{C as I,b as ee,c as se,a as O}from"./card-DPuYBbvn.js";import{C}from"./checkbox-CBCxgXEz.js";import{D as R,a as te,b as A,c as q,d as M}from"./dialog-Cax7YYOv.js";import{I as j}from"./input-BYxuuBn5.js";import{L as n}from"./label-BEJW7mG7.js";import{T as ae}from"./textarea-B9t2HIK8.js";import re from"./Header-BNvsmSmt.js";import U from"./Sidebar-Bz3-Sa5u.js";import{P as B,S as ie}from"./square-pen-zl5AK-hm.js";import{X as le}from"./x-rr-rPsU_.js";import{U as ne}from"./upload-jmpLuxZ8.js";import{C as de}from"./circle-check-big-BlR3sSzX.js";import{C as ce}from"./circle-x-BeMsVuQb.js";import{C as L}from"./calendar-CB1oa5u-.js";import{M as oe}from"./map-pin-BlSrQWwp.js";import{U as me}from"./users-kbIz6Mt8.js";import{T as xe}from"./trash-2-CI603OTp.js";import"./index-BcY7FhV-.js";import"./Combination-DNsBpELT.js";import"./index-3k_GYHV7.js";import"./createLucideIcon-Lam23By3.js";import"./dropdown-menu-Dzlu6hig.js";import"./index-CtBsO7PD.js";import"./user-DRk6pA1v.js";import"./log-out-j-dQhA56.js";import"./chart-column-CRYJK-8M.js";function ze({events:b,puroks:$}){const{flash:c}=W().props,[w,y]=x.useState(!1),[z,h]=x.useState(!1),[m,p]=x.useState(null),[f,k]=x.useState(new Set),[N,g]=x.useState(null),o=x.useRef(null),{data:t,setData:i,processing:D,errors:r,reset:S}=Y({title:"",description:"",start_date:"",end_date:"",purok_ids:[],has_certificate:!1,target_all_residents:!1,image:null}),G=s=>{s.preventDefault();const a=new FormData;a.append("title",t.title),a.append("description",t.description),a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date),t.purok_ids.length>0&&t.purok_ids.forEach((d,u)=>{a.append(`purok_ids[${u}]`,d.toString())}),a.append("has_certificate",t.has_certificate?"1":"0"),a.append("target_all_residents",t.target_all_residents?"1":"0"),t.image&&a.append("image",t.image),_.post(route("partner.events.create"),a,{forceFormData:!0,onSuccess:()=>{S(),h(!1),g(null),o.current&&(o.current.value=""),window.location.reload()}})},H=s=>{var d;const a=(d=s.target.files)==null?void 0:d[0];if(a){i("image",a);const u=new FileReader;u.onload=V=>{var E;g((E=V.target)==null?void 0:E.result)},u.readAsDataURL(a)}},X=()=>{i("image",null),g(null),o.current&&(o.current.value="")},J=s=>{_.get(route("partner.events.edit",s))},K=s=>{k(a=>new Set([...a,s])),_.delete(route("partner.events.delete",s),{onFinish:()=>{k(a=>{const d=new Set(a);return d.delete(s),d}),p(null)}})},Q=s=>{switch(s){case"approved":return"bg-green-100 text-green-800";case"declined":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},v=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Events Management"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(U,{currentPage:"partner.events"})}),w&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>y(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(U,{currentPage:"partner.events"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(re,{userName:"Partner Agency",onMobileMenuToggle:()=>y(!w)}),e.jsxs("main",{className:"flex-1 overflow-auto p-4 lg:p-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Event Management"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage your event requests"})]}),e.jsxs(R,{open:z,onOpenChange:h,children:[e.jsx(te,{asChild:!0,children:e.jsxs(l,{className:"gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Create Event Request"]})}),e.jsxs(A,{className:"max-h-[90vh] overflow-y-auto sm:max-w-2xl",children:[e.jsx(q,{children:e.jsx(M,{children:"Create New Event Request"})}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Event Title *"}),e.jsx(j,{id:"title",value:t.title,onChange:s=>i("title",s.target.value),placeholder:"Enter event title",className:r.title?"border-red-500":""}),r.title&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.title})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description *"}),e.jsx(ae,{id:"description",value:t.description,onChange:s=>i("description",s.target.value),placeholder:"Enter event description",rows:4,className:r.description?"border-red-500":""}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.description})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"image",children:"Event Image"}),e.jsxs("div",{className:"space-y-4",children:[N&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:N,alt:"Event preview",className:"h-32 w-48 rounded-lg border object-cover"}),e.jsx(l,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:X,children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{type:"button",variant:"outline",className:"gap-2",onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},children:[e.jsx(ne,{className:"h-4 w-4"}),N?"Change Image":"Upload Image"]}),e.jsx(j,{ref:o,type:"file",accept:"image/*",onChange:H,className:"hidden"}),e.jsx("span",{className:"text-sm text-gray-500",children:"JPG, PNG, GIF up to 2MB"})]})]}),r.image&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.image})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(j,{id:"start_date",type:"datetime-local",value:t.start_date,onChange:s=>i("start_date",s.target.value),min:new Date().toISOString().slice(0,16),className:r.start_date?"border-red-500":""}),r.start_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.start_date})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"end_date",children:"End Date (Optional)"}),e.jsx(j,{id:"end_date",type:"datetime-local",value:t.end_date,onChange:s=>i("end_date",s.target.value),min:t.start_date?new Date(new Date(t.start_date).getTime()+24*60*60*1e3).toISOString().slice(0,16):void 0,className:r.end_date?"border-red-500":""}),r.end_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.end_date})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Target Audience"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"target_all_residents",checked:t.target_all_residents,onCheckedChange:s=>{i("target_all_residents",s),s&&i("purok_ids",[])}}),e.jsx(n,{htmlFor:"target_all_residents",className:"text-sm",children:"Target all residents"})]}),!t.target_all_residents&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Select Puroks (up to 3)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:$.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:`purok_${s.id}`,checked:t.purok_ids.includes(s.id),onCheckedChange:a=>{a?t.purok_ids.length<3&&i("purok_ids",[...t.purok_ids,s.id]):i("purok_ids",t.purok_ids.filter(d=>d!==s.id))},disabled:!t.purok_ids.includes(s.id)&&t.purok_ids.length>=3}),e.jsx(n,{htmlFor:`purok_${s.id}`,className:"text-sm",children:s.name})]},s.id))}),t.purok_ids.length>=3&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:"Maximum of 3 puroks can be selected"}),r.purok_ids&&e.jsx("p",{className:"text-sm text-red-600",children:r.purok_ids})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"has_certificate",checked:t.has_certificate,onCheckedChange:s=>i("has_certificate",s)}),e.jsx(n,{htmlFor:"has_certificate",className:"text-sm",children:"This event will have certificates"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{h(!1),S(),g(null),o.current&&(o.current.value="")},children:"Cancel"}),e.jsx(l,{type:"submit",disabled:D,children:D?"Creating...":"Create Event Request"})]})]})]})]})]}),(c==null?void 0:c.success)&&e.jsx("div",{className:"mb-6",children:e.jsxs(F,{className:"border-green-200 bg-green-50",children:[e.jsx(de,{className:"h-4 w-4 text-green-600"}),e.jsx(P,{className:"text-green-800",children:c.success})]})}),(c==null?void 0:c.error)&&e.jsx("div",{className:"mb-6",children:e.jsxs(F,{className:"border-red-200 bg-red-50",children:[e.jsx(ce,{className:"h-4 w-4 text-red-600"}),e.jsx(P,{className:"text-red-800",children:c.error})]})}),e.jsx("div",{className:"grid gap-4 md:gap-6",children:b.length>0?b.map(s=>{const a=s.status==="pending";return f.has(s.id),e.jsxs(I,{className:"shadow-sm",children:[e.jsx(ee,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(se,{className:"text-lg",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(T,{className:Q(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.has_certificate&&e.jsx(T,{variant:"outline",children:"Certificate"})]})]})}),e.jsxs(O,{className:"space-y-4",children:[s.image_path&&e.jsx("div",{children:e.jsx("img",{src:`/storage/${s.image_path}`,alt:s.title,className:"h-32 w-48 rounded-lg border object-cover"})}),e.jsx("p",{className:"text-gray-600",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm text-gray-500 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),v(s.start_date),s.end_date&&` - ${v(s.end_date)}`]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4"}),s.purok?s.purok.name:"All Residents"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),s.confirmed_attendees_count," attendees"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created: ",v(s.created_at)]}),a&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>J(s.id),className:"gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>p(s.id),className:"gap-2 text-red-600 hover:bg-red-50 hover:text-red-700",children:[e.jsx(xe,{className:"h-4 w-4"}),"Delete"]})]})]})]},s.id)}):e.jsx(I,{children:e.jsxs(O,{className:"py-12 text-center",children:[e.jsx(L,{className:"mx-auto mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No events found"}),e.jsx("p",{className:"mb-4 text-gray-600",children:"Create your first event request to get started."}),e.jsxs(l,{onClick:()=>h(!0),children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Create Event Request"]})]})})})]})]})]}),e.jsx(R,{open:m!==null,onOpenChange:()=>p(null),children:e.jsxs(A,{children:[e.jsx(q,{children:e.jsx(M,{children:"Confirm Delete"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Are you sure you want to delete this event request? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>p(null),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:()=>m&&K(m),disabled:m?f.has(m):!1,children:m&&f.has(m)?"Deleting...":"Delete"})]})]})]})})]})}export{ze as default};
