import{K as R,r as u,m as T,j as e,L as P,S as k}from"./app-CMI4-wRO.js";import{A as C,a as y}from"./alert-CJ8GlPtT.js";import{B as o}from"./button-CjgRfl2Z.js";import{C as U,b as A,c as L,a as q}from"./card-BMMac1pu.js";import{C as j}from"./checkbox-yec9LvMd.js";import{I as x}from"./input-U-gbYhML.js";import{L as n}from"./label-WbRJN2Id.js";import{T as B}from"./textarea-Cy1XPvJE.js";import O from"./Header-CuVDSu1a.js";import E from"./Sidebar-_Gwcflvj.js";import{A as $}from"./arrow-left-Dk3gdmnn.js";import{X as M}from"./x-CTnFQMCX.js";import{U as z}from"./upload-BUQcAw4K.js";import"./index-BKGyJec5.js";import"./Combination-C7RuGcr_.js";import"./index-Cw-0bTt-.js";import"./createLucideIcon-B7apOioz.js";import"./dropdown-menu-Ceb6RPeA.js";import"./index-CtBsO7PD.js";import"./user-DvpxExd6.js";import"./log-out-B8rT_nil.js";import"./chart-column-BrD46wav.js";import"./users-CGFr7jXR.js";import"./calendar-ClpuGV6g.js";import"./qr-code-BjihyYw7.js";import"./file-text-BeZHVW_e.js";function ue({event:a,puroks:w}){const{flash:c}=R().props,[_,f]=u.useState(!1),[h,v]=u.useState(a.image_path?`/storage/${a.image_path}`:null),m=u.useRef(null),{data:t,setData:d,processing:g,errors:r}=T({title:a.title,description:a.description,start_date:a.start_date?new Date(a.start_date).toISOString().slice(0,16):"",end_date:a.end_date?new Date(a.end_date).toISOString().slice(0,16):"",purok_ids:a.purok_ids||[],has_certificate:a.has_certificate,target_all_residents:a.target_all_residents,image:null}),F=s=>{s.preventDefault(),console.log("Form submission started",{eventId:a.id,formData:t,route:route("secretary.events.update",a.id)});const i=new FormData;i.append("title",t.title),i.append("description",t.description),i.append("start_date",t.start_date),t.end_date&&i.append("end_date",t.end_date),t.purok_ids.length>0&&t.purok_ids.forEach((l,p)=>{i.append(`purok_ids[${p}]`,l.toString())}),i.append("has_certificate",t.has_certificate?"1":"0"),i.append("target_all_residents",t.target_all_residents?"1":"0"),t.image&&i.append("image",t.image),i.append("_method","PUT"),console.log("FormData prepared, sending request..."),k.post(route("secretary.events.update",a.id),i,{forceFormData:!0,onStart:()=>{console.log("Request started")},onSuccess:l=>{console.log("Request successful",l)},onError:l=>{console.error("Request failed",l)},onFinish:()=>{console.log("Request finished")}})},S=s=>{var l;const i=(l=s.target.files)==null?void 0:l[0];if(i){d("image",i);const p=new FileReader;p.onload=I=>{var b;v((b=I.target)==null?void 0:b.result)},p.readAsDataURL(i)}},D=()=>{d("image",null),v(a.image_path?`/storage/${a.image_path}`:null),m.current&&(m.current.value="")},N=()=>{k.get(route("secretary.events"))};return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Edit Event"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(E,{currentPage:"secretary.events"})}),_&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>f(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(E,{currentPage:"secretary.events"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(O,{onMobileMenuToggle:()=>f(!_)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:e.jsxs("div",{className:"mx-auto max-w-3xl space-y-6",children:[(c==null?void 0:c.success)&&e.jsx(C,{className:"border-green-200 bg-green-50",children:e.jsx(y,{className:"text-green-800",children:c.success})}),(c==null?void 0:c.error)&&e.jsx(C,{className:"border-red-200 bg-red-50",children:e.jsx(y,{className:"text-red-800",children:c.error})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:N,className:"gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Event"}),e.jsx("p",{className:"text-gray-600",children:"Update event details"})]})]}),e.jsxs(U,{children:[e.jsx(A,{children:e.jsx(L,{children:"Event Details"})}),e.jsx(q,{children:e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Event Title *"}),e.jsx(x,{id:"title",value:t.title,onChange:s=>d("title",s.target.value),placeholder:"Enter event title",className:r.title?"border-red-500":""}),r.title&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.title})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description *"}),e.jsx(B,{id:"description",value:t.description,onChange:s=>d("description",s.target.value),placeholder:"Enter event description",rows:4,className:r.description?"border-red-500":""}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.description})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"image",children:"Event Image"}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:h,alt:"Event preview",className:"h-32 w-48 rounded-lg border object-cover"}),e.jsx(o,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:D,children:e.jsx(M,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{type:"button",variant:"outline",className:"gap-2",onClick:()=>{var s;return(s=m.current)==null?void 0:s.click()},children:[e.jsx(z,{className:"h-4 w-4"}),h?"Change Image":"Upload Image"]}),e.jsx(x,{ref:m,type:"file",accept:"image/*",onChange:S,className:"hidden"}),e.jsx("span",{className:"text-sm text-gray-500",children:"JPG, PNG, GIF up to 2MB"})]})]}),r.image&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.image})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(x,{id:"start_date",type:"datetime-local",value:t.start_date,onChange:s=>d("start_date",s.target.value),className:r.start_date?"border-red-500":""}),r.start_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.start_date})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"end_date",children:"End Date (Optional)"}),e.jsx(x,{id:"end_date",type:"datetime-local",value:t.end_date,onChange:s=>d("end_date",s.target.value),className:r.end_date?"border-red-500":""}),r.end_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.end_date})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"target_audience",children:"Target Audience"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"target_all_residents",checked:t.target_all_residents,onCheckedChange:s=>{d("target_all_residents",s),s&&d("purok_ids",[])}}),e.jsx(n,{htmlFor:"target_all_residents",className:"text-sm",children:"Target all residents"})]}),!t.target_all_residents&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Select Puroks (up to 3)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:w.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:`purok_${s.id}`,checked:t.purok_ids.includes(s.id),onCheckedChange:i=>{i?t.purok_ids.length<3&&d("purok_ids",[...t.purok_ids,s.id]):d("purok_ids",t.purok_ids.filter(l=>l!==s.id))},disabled:!t.purok_ids.includes(s.id)&&t.purok_ids.length>=3}),e.jsx(n,{htmlFor:`purok_${s.id}`,className:"text-sm",children:s.name})]},s.id))}),t.purok_ids.length>=3&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:"Maximum of 3 puroks can be selected"}),r.purok_ids&&e.jsx("p",{className:"text-sm text-red-600",children:r.purok_ids})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"has_certificate",checked:t.has_certificate,onCheckedChange:s=>d("has_certificate",s)}),e.jsx(n,{htmlFor:"has_certificate",className:"text-sm",children:"This event will have certificates"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:N,disabled:g,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:g,children:g?"Updating...":"Update Event"})]})]})})]})]})})]})]})]})}export{ue as default};
