import{K as ie,r as p,m as le,j as e,L as ne,S as g}from"./app-CI-4VFax.js";import{A as F,a as T}from"./alert-C4gFx7ac.js";import{B as O}from"./badge-X1Y-1lsO.js";import{B as l}from"./button-DjP5DCua.js";import{C as j,a as u,b as ce,c as de}from"./card-By9UBEhA.js";import{C}from"./checkbox-DOq9jEd2.js";import{D as M,a as oe,b as U,c as z,d as I,e as B}from"./dialog-CH9f8NV4.js";import{I as w}from"./input-JsKcxLOE.js";import{L as c}from"./label-BP0hMmYX.js";import{T as me}from"./textarea-hzxeYDdv.js";import xe from"./Header-CQq9UpBd.js";import L from"./Sidebar-DhchyCDK.js";import{P as R,S as he}from"./square-pen-berOnY1k.js";import{X as pe}from"./x-D-7SxpsS.js";import{U as ge}from"./upload-C3OPw4M2.js";import{C as Q}from"./circle-check-big-BYglXicT.js";import{C as je}from"./circle-x-DsPIyfSc.js";import{C as $}from"./calendar--sGQ-WuF.js";import{C as ue}from"./circle-alert-DZeGBylx.js";import{U as G}from"./users-xRXBnnjG.js";import{A as H}from"./award-B4zqoYlp.js";import{C as fe}from"./clock-CZ9DEXGu.js";import{M as Ne}from"./map-pin-D11Tmc_G.js";import{T as ve}from"./trash-2-Bb4ZQ0wL.js";import{E as be}from"./eye-BRYbbQtW.js";import{Q as we}from"./qr-code-Ca4C_Rzn.js";import"./Combination-CgmyZskN.js";import"./index-C0iWjysw.js";import"./index-DTYLtReL.js";import"./createLucideIcon-BxQM5x_N.js";import"./dropdown-menu-xtMhRY4o.js";import"./index-CtBsO7PD.js";import"./user-CtEl8JKF.js";import"./log-out-Bc6-Y8uB.js";import"./chart-column-D3jKJw_X.js";import"./file-text-BlCDcJL6.js";function is({events:x,puroks:q}){const{flash:d}=ie().props,[k,S]=p.useState(!1),[X,f]=p.useState(!1),[_,h]=p.useState(new Set),[m,N]=p.useState(null),[y,v]=p.useState(null),o=p.useRef(null),{data:a,setData:n,processing:D,errors:i,reset:E}=le({title:"",description:"",start_date:"",end_date:"",purok_ids:[],has_certificate:!1,target_all_residents:!1,image:null}),J=s=>{s.preventDefault();const t=new FormData;t.append("title",a.title),t.append("description",a.description),t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date),a.purok_ids.length>0&&a.purok_ids.forEach((r,b)=>{t.append(`purok_ids[${b}]`,r.toString())}),t.append("has_certificate",a.has_certificate?"1":"0"),t.append("target_all_residents",a.target_all_residents?"1":"0"),a.image&&t.append("image",a.image),g.post(route("secretary.events.create"),t,{forceFormData:!0,onSuccess:()=>{E(),f(!1),v(null),o.current&&(o.current.value=""),window.location.reload()}})},K=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){n("image",t);const b=new FileReader;b.onload=re=>{var P;v((P=re.target)==null?void 0:P.result)},b.readAsDataURL(t)}},V=()=>{n("image",null),v(null),o.current&&(o.current.value="")},W=s=>{g.get(route("secretary.events.edit",s))},Y=s=>{h(t=>new Set([...t,s])),g.delete(route("secretary.events.delete",s),{onFinish:()=>{h(t=>{const r=new Set(t);return r.delete(s),r}),N(null)}})},Z=s=>{h(t=>new Set([...t,s])),g.post(route("secretary.events.assign-qr",s),{},{onFinish:()=>{h(t=>{const r=new Set(t);return r.delete(s),r})}})},ee=s=>{h(t=>new Set([...t,s])),g.post(route("secretary.events.assign-certificates",s),{},{onFinish:()=>{h(t=>{const r=new Set(t);return r.delete(s),r})}})},se=s=>{g.get(route("secretary.events.attendees",s))},te=s=>{switch(s){case"approved":return"bg-green-100 text-green-800";case"declined":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},A=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ae=s=>new Date(s)<new Date;return e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:"Event Management"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(L,{currentPage:"secretary.events"})}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>S(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(L,{currentPage:"secretary.events"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(xe,{onMobileMenuToggle:()=>S(!k)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Create and manage community events"})]}),e.jsxs(M,{open:X,onOpenChange:f,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(l,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Create Event"]})}),e.jsxs(U,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(z,{children:[e.jsx(I,{children:"Create New Event"}),e.jsx(B,{children:"Fill in the details below to create a new community event that will be submitted for captain approval."})]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"title",children:"Event Title *"}),e.jsx(w,{id:"title",value:a.title,onChange:s=>n("title",s.target.value),placeholder:"Enter event title",className:i.title?"border-red-500":""}),i.title&&e.jsx("p",{className:"text-sm text-red-600",children:i.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description *"}),e.jsx(me,{id:"description",value:a.description,onChange:s=>n("description",s.target.value),placeholder:"Enter event description",rows:4,className:i.description?"border-red-500":""}),i.description&&e.jsx("p",{className:"text-sm text-red-600",children:i.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"image",children:"Event Image"}),e.jsxs("div",{className:"space-y-4",children:[y&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:y,alt:"Event preview",className:"h-32 w-48 rounded-lg border object-cover"}),e.jsx(l,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:V,children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{type:"button",variant:"outline",className:"gap-2",onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},children:[e.jsx(ge,{className:"h-4 w-4"}),y?"Change Image":"Upload Image"]}),e.jsx(w,{ref:o,type:"file",accept:"image/*",onChange:K,className:"hidden"}),e.jsx("span",{className:"text-sm text-gray-500",children:"JPG, PNG, GIF up to 2MB"})]})]}),i.image&&e.jsx("p",{className:"text-sm text-red-600",children:i.image})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(w,{id:"start_date",type:"datetime-local",value:a.start_date,onChange:s=>n("start_date",s.target.value),min:new Date().toISOString().slice(0,16),className:i.start_date?"border-red-500":""}),i.start_date&&e.jsx("p",{className:"text-sm text-red-600",children:i.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"end_date",children:"End Date (Optional)"}),e.jsx(w,{id:"end_date",type:"datetime-local",value:a.end_date,onChange:s=>n("end_date",s.target.value),min:a.start_date?new Date(new Date(a.start_date).getTime()+24*60*60*1e3).toISOString().slice(0,16):void 0,className:i.end_date?"border-red-500":""}),i.end_date&&e.jsx("p",{className:"text-sm text-red-600",children:i.end_date})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Target Audience"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"target_all_residents",checked:a.target_all_residents,onCheckedChange:s=>{n("target_all_residents",s),s&&n("purok_ids",[])}}),e.jsx(c,{htmlFor:"target_all_residents",className:"text-sm",children:"Target all residents"})]}),!a.target_all_residents&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Select Puroks (up to 3)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:q.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:`purok_${s.id}`,checked:a.purok_ids.includes(s.id),onCheckedChange:t=>{t?a.purok_ids.length<3&&n("purok_ids",[...a.purok_ids,s.id]):n("purok_ids",a.purok_ids.filter(r=>r!==s.id))},disabled:!a.purok_ids.includes(s.id)&&a.purok_ids.length>=3}),e.jsx(c,{htmlFor:`purok_${s.id}`,className:"text-sm",children:s.name})]},s.id))}),a.purok_ids.length>=3&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:"Maximum of 3 puroks can be selected"}),i.purok_ids&&e.jsx("p",{className:"text-sm text-red-600",children:i.purok_ids})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"has_certificate",checked:a.has_certificate,onCheckedChange:s=>n("has_certificate",s)}),e.jsx(c,{htmlFor:"has_certificate",className:"text-sm",children:"This event will have certificates"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{f(!1),E(),v(null),o.current&&(o.current.value="")},children:"Cancel"}),e.jsx(l,{type:"submit",disabled:D,children:D?"Creating...":"Create Event"})]})]})]})]})]}),(d==null?void 0:d.success)&&e.jsxs(F,{className:"border-green-200 bg-green-50",children:[e.jsx(Q,{className:"h-4 w-4 text-green-600"}),e.jsx(T,{className:"text-green-800",children:d.success})]}),(d==null?void 0:d.error)&&e.jsxs(F,{className:"border-red-200 bg-red-50",children:[e.jsx(je,{className:"h-4 w-4 text-red-600"}),e.jsx(T,{className:"text-red-800",children:d.error})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-4",children:[e.jsx(j,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Events"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.length})]}),e.jsx($,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(j,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Approval"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.filter(s=>s.status==="pending").length})]}),e.jsx(ue,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(j,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved Events"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.filter(s=>s.status==="approved").length})]}),e.jsx(Q,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(j,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Attendees"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.reduce((s,t)=>s+t.confirmed_attendees_count,0)})]}),e.jsx(G,{className:"h-8 w-8 text-purple-600"})]})})})]}),e.jsxs(j,{children:[e.jsx(ce,{children:e.jsx(de,{children:"All Events"})}),e.jsx(u,{children:x.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx($,{className:"mx-auto mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No events found"}),e.jsx("p",{className:"mb-4 text-gray-600",children:"Create your first event to get started."}),e.jsxs(l,{onClick:()=>f(!0),children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>{const t=_.has(s.id);ae(s.start_date);const r=s.status==="pending";return e.jsx("div",{className:"rounded-lg border border-gray-200 p-6 transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsx(O,{className:te(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.has_certificate&&e.jsxs(O,{variant:"outline",className:"border-purple-200 text-purple-800",children:[e.jsx(H,{className:"mr-1 h-3 w-3"}),"Certificate"]})]}),s.image_path&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:`/storage/${s.image_path}`,alt:s.title,className:"h-32 w-48 rounded-lg border object-cover"})}),e.jsx("p",{className:"text-gray-600",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm text-gray-600 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:A(s.start_date)})]}),s.purok&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:s.purok.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.confirmed_attendees_count," attendees"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created by: ",s.creator.name," • ",A(s.created_at)]})]}),e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-start",children:[r&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>W(s.id),className:"gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>N(s.id),className:"gap-2 text-red-600 hover:bg-red-50 hover:text-red-700",children:[e.jsx(ve,{className:"h-4 w-4"}),"Delete"]})]}),s.status==="approved"&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>se(s.id),className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"View Attendees"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Z(s.id),disabled:t,className:"gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),t?"Processing...":"Assign QR Codes"]}),s.has_certificate&&e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>ee(s.id),disabled:t,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),t?"Processing...":"Assign Certificates"]})]})]})]})},s.id)})})})]})]})})]})]}),e.jsx(M,{open:m!==null,onOpenChange:()=>N(null),children:e.jsxs(U,{children:[e.jsxs(z,{children:[e.jsx(I,{children:"Confirm Delete"}),e.jsx(B,{children:"Are you sure you want to delete this event? This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>N(null),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:()=>m&&Y(m),disabled:m?_.has(m):!1,children:m&&_.has(m)?"Deleting...":"Delete"})]})]})})]})}export{is as default};
