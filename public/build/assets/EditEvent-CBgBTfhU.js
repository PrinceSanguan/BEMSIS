import{K as P,r as g,m as U,j as e,L as A,S as C}from"./app-DpTxKQAf.js";import{A as S,a as y}from"./alert-B1caCfZ1.js";import{B as o}from"./button-EmHOAWCh.js";import{C as L,b as q,c as B,a as O}from"./card-DrGcUUNM.js";import{C as w}from"./checkbox-DJvJ0Xa_.js";import{I as p}from"./input-6b6wo28k.js";import{L as d}from"./label-DQBlYoye.js";import{S as z,a as G,b as M,c as H,d as V}from"./select-YpwfVHn3.js";import{T as $}from"./textarea-CyH7-6cF.js";import J from"./Header-CPfrUZWL.js";import E from"./Sidebar-CiCbE-lx.js";import{A as K}from"./arrow-left-D9eXvPLf.js";import{X}from"./x-Cw8E9nhQ.js";import{U as Q}from"./upload-CmZXVH-E.js";import"./Combination-DQHq3tOk.js";import"./index-BtH7JKO-.js";import"./index-CtX3QR9Y.js";import"./createLucideIcon-uFufCLSQ.js";import"./dropdown-menu-CKSOrcSz.js";import"./index-CtBsO7PD.js";import"./user-wZ1yEFEq.js";import"./log-out-BUIlX1OT.js";import"./chart-column-ca2rcyDB.js";import"./users-cUYpqWpM.js";import"./calendar--REYLK8D.js";import"./qr-code-Dwz7AgoG.js";import"./file-text-Bexp6W_O.js";function Ce({event:r,puroks:F}){var v,N;const{flash:n}=P().props,[u,j]=g.useState(!1),[x,_]=g.useState(r.image_path?`/storage/${r.image_path}`:null),m=g.useRef(null),{data:s,setData:l,processing:h,errors:a}=U({title:r.title,description:r.description,start_date:r.start_date?new Date(r.start_date).toISOString().slice(0,16):"",end_date:r.end_date?new Date(r.end_date).toISOString().slice(0,16):"",purok_id:((N=(v=r.purok)==null?void 0:v.id)==null?void 0:N.toString())||"",has_certificate:r.has_certificate,target_all_residents:r.target_all_residents,image:null}),D=t=>{t.preventDefault(),console.log("Form submission started",{eventId:r.id,formData:s,route:route("secretary.events.update",r.id)});const i=new FormData;i.append("title",s.title),i.append("description",s.description),i.append("start_date",s.start_date),s.end_date&&i.append("end_date",s.end_date),s.purok_id&&i.append("purok_id",s.purok_id),i.append("has_certificate",s.has_certificate?"1":"0"),i.append("target_all_residents",s.target_all_residents?"1":"0"),s.image&&i.append("image",s.image),i.append("_method","PUT"),console.log("FormData prepared, sending request..."),C.post(route("secretary.events.update",r.id),i,{forceFormData:!0,onStart:()=>{console.log("Request started")},onSuccess:c=>{console.log("Request successful",c)},onError:c=>{console.error("Request failed",c)},onFinish:()=>{console.log("Request finished")}})},I=t=>{var c;const i=(c=t.target.files)==null?void 0:c[0];if(i){l("image",i);const b=new FileReader;b.onload=R=>{var k;_((k=R.target)==null?void 0:k.result)},b.readAsDataURL(i)}},T=()=>{l("image",null),_(r.image_path?`/storage/${r.image_path}`:null),m.current&&(m.current.value="")},f=()=>{C.get(route("secretary.events"))};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Edit Event"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(E,{currentPage:"secretary.events"})}),u&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>j(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(E,{currentPage:"secretary.events"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(J,{onMobileMenuToggle:()=>j(!u)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:e.jsxs("div",{className:"mx-auto max-w-3xl space-y-6",children:[(n==null?void 0:n.success)&&e.jsx(S,{className:"border-green-200 bg-green-50",children:e.jsx(y,{className:"text-green-800",children:n.success})}),(n==null?void 0:n.error)&&e.jsx(S,{className:"border-red-200 bg-red-50",children:e.jsx(y,{className:"text-red-800",children:n.error})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:f,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Event"}),e.jsx("p",{className:"text-gray-600",children:"Update event details"})]})]}),e.jsxs(L,{children:[e.jsx(q,{children:e.jsx(B,{children:"Event Details"})}),e.jsx(O,{children:e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"title",children:"Event Title *"}),e.jsx(p,{id:"title",value:s.title,onChange:t=>l("title",t.target.value),placeholder:"Enter event title",className:a.title?"border-red-500":""}),a.title&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.title})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description *"}),e.jsx($,{id:"description",value:s.description,onChange:t=>l("description",t.target.value),placeholder:"Enter event description",rows:4,className:a.description?"border-red-500":""}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.description})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"image",children:"Event Image"}),e.jsxs("div",{className:"space-y-4",children:[x&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:x,alt:"Event preview",className:"h-32 w-48 rounded-lg border object-cover"}),e.jsx(o,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:T,children:e.jsx(X,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{type:"button",variant:"outline",className:"gap-2",onClick:()=>{var t;return(t=m.current)==null?void 0:t.click()},children:[e.jsx(Q,{className:"h-4 w-4"}),x?"Change Image":"Upload Image"]}),e.jsx(p,{ref:m,type:"file",accept:"image/*",onChange:I,className:"hidden"}),e.jsx("span",{className:"text-sm text-gray-500",children:"JPG, PNG, GIF up to 2MB"})]})]}),a.image&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.image})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(p,{id:"start_date",type:"datetime-local",value:s.start_date,onChange:t=>l("start_date",t.target.value),className:a.start_date?"border-red-500":""}),a.start_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.start_date})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"end_date",children:"End Date (Optional)"}),e.jsx(p,{id:"end_date",type:"datetime-local",value:s.end_date,onChange:t=>l("end_date",t.target.value),className:a.end_date?"border-red-500":""}),a.end_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.end_date})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"target_audience",children:"Target Audience"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"target_all_residents",checked:s.target_all_residents,onCheckedChange:t=>{l("target_all_residents",t),t&&l("purok_id","")}}),e.jsx(d,{htmlFor:"target_all_residents",className:"text-sm",children:"Target all residents"})]}),!s.target_all_residents&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"purok_id",children:"Select Purok"}),e.jsxs(z,{value:s.purok_id,onValueChange:t=>l("purok_id",t),children:[e.jsx(G,{className:a.purok_id?"border-red-500":"",children:e.jsx(M,{placeholder:"Select a purok"})}),e.jsx(H,{children:F.map(t=>e.jsx(V,{value:t.id.toString(),children:t.name},t.id))})]}),a.purok_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.purok_id})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"has_certificate",checked:s.has_certificate,onCheckedChange:t=>l("has_certificate",t)}),e.jsx(d,{htmlFor:"has_certificate",className:"text-sm",children:"This event will have certificates"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:f,disabled:h,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:h,children:h?"Updating...":"Update Event"})]})]})})]})]})})]})]})]})}export{Ce as default};
