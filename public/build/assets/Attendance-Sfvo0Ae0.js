import{r,j as e,L as C}from"./app-D3T1n4bI.js";import{B as Q}from"./button-f6i-Hsu5.js";import{C as o,b as m,c as x,a as h}from"./card-XNqk8LyP.js";import{D as S,b as T,c as R,d as k}from"./dialog-fboHmZmb.js";import{T as E,a as M,b as p,c as g}from"./tabs-CrFYA874.js";import _ from"./Header-CyilP6fj.js";import j from"./Sidebar-DGJ2hna2.js";import{C as A}from"./calendar-DbRQwxhL.js";import{C as L}from"./clock-ZOi8I8CW.js";import{M as P}from"./map-pin-Dif7QdtW.js";import{Q as D}from"./qr-code-iSFG00TU.js";import{C as H}from"./circle-check-big-DGrTJ97t.js";import"./Combination-Cjm0Iuft.js";import"./index-4zbVwmYN.js";import"./dropdown-menu-B3k3E-lp.js";import"./createLucideIcon-BpmfQe8N.js";import"./x-Pu1PIWjA.js";import"./badge-r4QWlGEb.js";import"./index-CtBsO7PD.js";import"./house-fL4Wfdlk.js";import"./user-DrVmvJgf.js";import"./log-out-Bu8ebVwl.js";import"./chart-column-Dj_6RZIY.js";import"./award-us1Ch1UW.js";import"./bell-B1RPYDky.js";import"./settings-A_dL-YCl.js";function oe({confirmedEvents:f,attendanceHistory:u}){const[i,n]=r.useState(!1),[l,N]=r.useState(null),[c,v]=r.useState(null),[y,d]=r.useState(!1),w=s=>{switch(s){case"attended":return"bg-green-100 text-green-800";case"missed":return"bg-red-100 text-red-800";default:return"bg-blue-100 text-blue-800"}},b=async s=>{N(s);try{const a=await fetch(route("resident.attendance.qr",s.id));if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();if(t.error)throw new Error(t.error);if(t.qr_image_url)v(t.qr_image_url),d(!0);else throw new Error("No QR code data received")}catch(a){console.error("Error fetching QR code:",a),alert(`Error loading QR code: ${a.message}. Please try again.`)}};return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"My Attendance"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(j,{currentPage:"resident.attendance"})}),i&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>n(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(j,{currentPage:"resident.attendance"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(_,{onMobileMenuToggle:()=>n(!i)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Attendance"}),e.jsx("p",{className:"text-gray-600",children:"Track your event attendance and generate QR codes."})]}),e.jsxs(E,{defaultValue:"confirmed",className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(p,{value:"confirmed",children:"Confirmed Events"}),e.jsx(p,{value:"history",children:"Attendance History"})]}),e.jsx(g,{value:"confirmed",className:"space-y-4",children:f.map(s=>{var a;return e.jsxs(o,{className:"shadow-sm",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(x,{className:"flex items-center justify-between text-lg",children:[s.event.title,e.jsx("span",{className:"rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-600",children:"Confirmed"})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm text-gray-500 sm:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4"}),new Date(s.event.start_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),new Date(s.event.start_date).toLocaleTimeString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),((a=s.event.purok)==null?void 0:a.name)||"All Puroks"]})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:e.jsxs(Q,{size:"sm",className:"gap-2",onClick:()=>b(s),children:[e.jsx(D,{className:"h-4 w-4"}),"Generate QR Code"]})})]})]},s.id)})}),e.jsx(g,{value:"history",className:"space-y-4",children:u.map(s=>{var a;return e.jsxs(o,{className:"shadow-sm",children:[e.jsx(m,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{className:"text-lg",children:s.event.title}),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${w(s.status)}`,children:s.status==="attended"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),"Attended"]}):"Missed"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Date"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.event.start_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Location"}),e.jsx("p",{className:"text-gray-600",children:((a=s.event.purok)==null?void 0:a.name)||"All Puroks"})]}),s.scanned_at&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Scanned At"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.scanned_at).toLocaleTimeString()})]})]})})]},s.id)})})]})]})})]}),e.jsx(S,{open:y,onOpenChange:d,children:e.jsxs(T,{className:"max-w-md",children:[e.jsx(R,{children:e.jsxs(k,{children:["QR Code for ",l==null?void 0:l.event.title]})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[c&&e.jsx("div",{className:"rounded-lg border bg-white p-4",children:e.jsx("img",{src:c,alt:"QR Code",className:"h-48 w-48",onError:s=>{console.error("Failed to load QR code image"),s.currentTarget.style.display="none"}})}),e.jsx("p",{className:"text-center text-sm text-gray-600",children:"Show this QR code to the event organizer for attendance verification."})]})]})})]})]})}export{oe as default};
