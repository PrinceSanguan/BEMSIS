import{r as t,j as e,L as A,S as E}from"./app-CMI4-wRO.js";import{B as h}from"./button-CjgRfl2Z.js";import{C as g,b as p,c as j,a as f}from"./card-BMMac1pu.js";import{D as _,b as M,c as L,d as P}from"./dialog-LrRS0fHk.js";import{T as D,a as H,b as u,c as N}from"./tabs-B-GZ2X8N.js";import I from"./Header-BBtcsF1e.js";import v from"./Sidebar-C62c6G-B.js";import{C as y}from"./calendar-ClpuGV6g.js";import{C as q}from"./clock-CbVwXtzS.js";import{M as z}from"./map-pin-7ABLEzBR.js";import{C as w}from"./circle-check-big-Df9E0GMW.js";import{Q as B}from"./qr-code-BjihyYw7.js";import"./Combination-C7RuGcr_.js";import"./index-BKGyJec5.js";import"./dropdown-menu-Ceb6RPeA.js";import"./createLucideIcon-B7apOioz.js";import"./x-CTnFQMCX.js";import"./badge-DRu1kQMu.js";import"./index-CtBsO7PD.js";import"./house-cEkvYD-7.js";import"./user-DvpxExd6.js";import"./log-out-B8rT_nil.js";import"./chart-column-BrD46wav.js";import"./award-DeCtfeYx.js";import"./bell-CywUnnhv.js";import"./settings-C-KXUrMN.js";function ge({confirmedEvents:b,attendanceHistory:C}){const[l,i]=t.useState(!1),[n,S]=t.useState(null),[c,R]=t.useState(null),[Q,d]=t.useState(!1),[o,m]=t.useState(!1),x=()=>{m(!0),E.visit(route("resident.attendance"),{preserveState:!1,preserveScroll:!0,onFinish:()=>m(!1)})};t.useEffect(()=>{const s=setInterval(x,3e4);return()=>clearInterval(s)},[]);const T=s=>{switch(s){case"attended":return"bg-green-100 text-green-800";case"missed":return"bg-red-100 text-red-800";default:return"bg-blue-100 text-blue-800"}},k=async s=>{S(s);try{const a=await fetch(route("resident.attendance.qr",s.id));if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(r.error)throw new Error(r.error);if(r.qr_image_url)R(r.qr_image_url),d(!0);else throw new Error("No QR code data received")}catch(a){console.error("Error fetching QR code:",a),alert(`Error loading QR code: ${a.message}. Please try again.`)}};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"My Attendance"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(v,{currentPage:"resident.attendance"})}),l&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>i(!1)}),e.jsx("div",{className:"absolute top-0 left-0 h-full",children:e.jsx(v,{currentPage:"resident.attendance"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(I,{onMobileMenuToggle:()=>i(!l)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Attendance"}),e.jsx("p",{className:"text-gray-600",children:"Track your event attendance and generate QR codes."})]}),e.jsxs(h,{variant:"outline",onClick:x,disabled:o,className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),o?"Refreshing...":"Refresh"]})]}),e.jsxs(D,{defaultValue:"confirmed",className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(u,{value:"confirmed",children:"Confirmed Events"}),e.jsx(u,{value:"history",children:"Attendance History"})]}),e.jsx(N,{value:"confirmed",className:"space-y-4",children:b.map(s=>e.jsxs(g,{className:"shadow-sm",children:[e.jsx(p,{className:"pb-3",children:e.jsxs(j,{className:"flex items-center justify-between text-lg",children:[s.event.title,e.jsx("span",{className:"rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-600",children:"Confirmed"})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm text-gray-500 sm:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4"}),new Date(s.event.start_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),new Date(s.event.start_date).toLocaleTimeString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),s.event.purok_names||"All Puroks"]})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:s.scanned?e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-green-100 px-3 py-2 text-sm text-green-700",children:[e.jsx(w,{className:"h-4 w-4"}),"Already Scanned"]}):e.jsxs(h,{size:"sm",className:"gap-2",onClick:()=>k(s),children:[e.jsx(B,{className:"h-4 w-4"}),"Generate QR Code"]})})]})]},s.id))}),e.jsx(N,{value:"history",className:"space-y-4",children:C.map(s=>{var a;return e.jsxs(g,{className:"shadow-sm",children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{className:"text-lg",children:s.event.title}),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${T(s.status)}`,children:s.status==="attended"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"Attended"]}):"Missed"})]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Date"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.event.start_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Location"}),e.jsx("p",{className:"text-gray-600",children:((a=s.event.purok)==null?void 0:a.name)||"All Puroks"})]}),s.scanned_at&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Scanned At"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.scanned_at).toLocaleTimeString()})]})]})})]},s.id)})})]})]})})]}),e.jsx(_,{open:Q,onOpenChange:d,children:e.jsxs(M,{className:"max-w-md",children:[e.jsx(L,{children:e.jsxs(P,{children:["QR Code for ",n==null?void 0:n.event.title]})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[c&&e.jsx("div",{className:"rounded-lg border bg-white p-4",children:e.jsx("img",{src:c,alt:"QR Code",className:"h-48 w-48",onError:s=>{console.error("Failed to load QR code image"),s.currentTarget.style.display="none"}})}),e.jsx("p",{className:"text-center text-sm text-gray-600",children:"Show this QR code to the event organizer for attendance verification."})]})]})})]})]})}export{ge as default};
